import matplotlib.pyplot as plt, numpy, scipy.optimize

def fit_sin(tt, yy):
    # copied from https://stackoverflow.com/a/42322656
    '''Fit sin to the input time sequence, and return fitting parameters "amp", "omega", "phase", "offset", "freq", "period" and "fitfunc"'''
    tt = numpy.array(tt)
    yy = numpy.array(yy)
    ff = numpy.fft.fftfreq(len(tt), (tt[1]-tt[0]))   # assume uniform spacing
    Fyy = abs(numpy.fft.fft(yy))
    guess_freq = abs(ff[numpy.argmax(Fyy[1:])+1])   # excluding the zero frequency "peak", which is related to offset
    guess_amp = numpy.std(yy) * 2.**0.5
    guess_offset = numpy.mean(yy)
    guess = numpy.array([guess_amp, 2.*numpy.pi*guess_freq, 0., guess_offset])

    def sinfunc(t, A, w, p, c):  return A * numpy.sin(w*t + p) + c
    popt, pcov = scipy.optimize.curve_fit(sinfunc, tt, yy, p0=guess)
    A, w, p, c = popt
    f = w/(2.*numpy.pi)
    fitfunc = lambda t: A * numpy.sin(w*t + p) + c
    return {"amp": A, "omega": w, "phase": p, "offset": c, "freq": f, "period": 1./f, "fitfunc": fitfunc, "maxcov": numpy.max(pcov), "rawres": (guess,popt,pcov)}


# DSCF5493.jpg -al 0.7 -k 5
# 750 500
data5 = [[-80.0,224.60065265859353,-1312.6864451950782],
[-70.0,355.2882962073832,-1032.2776773920132],
[-60.0,384.9859027575053,-721.085657822283],
[-50.0,315.8081284604309,-412.2419372757852],
[-40.0,140.12459606665914,-149.77559525884692],
[-30.0,-115.88289544191605,32.106299731770605],
[-20.0,-412.618496689632,130.37951586648927],
[-10.0,-723.6257652990888,115.38389555626799],
[0.0,-990.0,4.284705882352941],
[10.0,-1300.157199050952,118.71858789033786],
[20.0,-1615.9604977287495,138.0725731686827],
[30.0,-1915.5678751731757,43.63694359316325],
[40.0,-2173.3453066703605,-137.10052541901916],
[50.0,-2350.6698467092424,-396.74374958042046],
[60.0,-2421.1247831000724,-704.8906399426726],
[70.0,-2390.6596625460775,-1014.0575655891602],
[80.0,-2255.7678381028645,-1292.80748466437],
[90.0,-1996.8614379084968,-1510.0]]
{'amp': -1370.3712758707734, 
'omega': 0.025059792398020416, 
'phase': 0.0076397485990566194, 
'offset': -1006.4152923672953}

# DSCF5493.jpg -al 0.7 -k 10
# 750 500
data10 = [[-80.0,113.32156462982965,-670.7047120255335],
[-70.0,178.61510812164352,-528.4491074121008],
[-60.0,193.51111416173694,-370.8485262857475],
[-50.0,157.63505475504326,-214.61783794597397],
[-40.0,62.35128575980025,-90.24190004370479],
[-30.0,-66.26765317125279,3.004759670494593],
[-20.0,-212.21167642418868,56.066300358469846],
[-10.0,-365.8020160786859,57.38897186134682],
[0,-490.0,4.510352941176471],
[10.0,-657.8208968415182,60.81983374336903],
[20.0,-814.6835120310141,61.32458022423518],
[30.0,-965.2933653692544,14.251893889435092],
[40.0,-1094.5428956254816,-75.87208353886825],
[50.0,-1190.8278881682204,-200.56739988862194],
[60.0,-1228.5988951222375,-354.5642927198626],
[70.0,-1210.7112190375692,-509.0794093171624],
[80.0,-1145.6612220745403,-650.9219210427774],
[90.0,-996.356862745098,-750.0]]
{'amp': -690.8104618773297, 
'omega': 0.025056923080378993, 
'phase': 0.007855955480969505, 
'offset': -509.1500906355915}

# signal-2022-05-30-175346_004-square.jpg -al 0.7 -k 20
# 1106 1106
data20 = [[-80.0,116.76418095674576,-424.1508873304841],
[-70.0,142.3792649592978,-291.27831359504995],
[-60.0,123.2897541246858,-156.80545311846515],
[-50.0,62.70361259047121,-33.76992250769524],
[-40.0,-33.41962175864194,65.15278011799421],
[-30.0,-154.82223072260527,128.59286150694675],
[-20.0,-287.81911916792336,150.8066139706674],
[-10.0,-418.3927036694372,127.24520460038039],
[0.0,-530.0,48.20163656013587],
[10.0,-647.6132195375812,130.72087154755076],
[20.0,-780.3277041150199,157.67536285587448],
[30.0,-914.8142699382914,138.59736715962697],
[40.0,-1036.160067310964,77.66335482440748],
[50.0,-1132.3355215142415,-18.103907038012096],
[60.0,-1193.0826481105603,-139.48754638256418],
[70.0,-1210.779266874422,-272.54944081003805],
[80.0,-1163.4579876088412,-407.9281725048506],
[90.0,-1090.7876372548455,-510.0]]
{'amp': -657.1614230190268, 
'omega': 0.021848145517453177, 
'phase': 0.023300446510129535, 
'offset': -522.9776673924245}

# IMG-20190517-WA0000.jpg -al 0.7 -k 10
# 602 500
data202 = [[-80.0,75.70470087332791,-529.2132752625174],
[-70.0,123.15835686512737,-402.17799798913325],
[-60.0,123.49211122125155,-264.78105802302736],
[-50.0,81.89460901484472,-131.95097329874125],
[-40.0,-0.9981809446718444,-18.59716027099205],
[-30.0,-125.63650262415644,46.36398201023126],
[-20.0,-260.4977021195891,70.05477502250616],
[-10.0,-393.7906974523663,48.880623939341554],
[0.0,-490.0,5.489803921568628],
[10.0,-629.5398897790883,52.36710446183915],
[20.0,-766.3762901863029,76.74040498677243],
[30.0,-905.7188555653328,56.411528502988055],
[40.0,-1029.248043339081,-5.720379406273679],
[50.0,-1113.4094879475035,-116.64772958643152],
[60.0,-1158.741534600508,-247.48800092773064],
[70.0,-1155.8418272735073,-383.32781284392615],
[80.0,-1106.908928997177,-509.51950360863344],
[90.0,-995.9405731526344,-610.0]]
{'amp': -626.8069380173007, 
'omega': 0.023819060658213202, 
'phase': 0.006919655943563064, 
'offset': -509.512960531306}

# signal-2022-05-30-175346_004.jpg -al 0.7 -k 10
# 723 500
data102 = [[-80.0,126.08454276215477,-604.9396669382293],
[-70.0,191.9920003122797,-465.5615175201771],
[-60.0,207.91102107186867,-311.42608623403294],
[-50.0,173.46383151550285,-156.0129492724934],
[-40.0,80.35078343711626,-33.63404369870409],
[-30.0,-45.008292360382896,57.91682232411026],
[-20.0,-190.46155505569698,108.0930936921043],
[-10.0,-345.3637411507274,91.30206816751085],
[0.0,-470.0,49.31921568632317],
[10.0,-623.246790654903,94.74019357664909],
[20.0,-778.5994164936733,114.93416039556628],
[30.0,-924.8256721466495,67.91470391601715],
[40.0,-1050.9603502532125,-19.402220493209313],
[50.0,-1144.1267226212628,-142.0727859406531],
[60.0,-1177.9051013686685,-294.1043550948614],
[70.0,-1161.2999592297554,-446.8118066843758],
[80.0,-1095.0410066900324,-585.1977628422419],
[90.0,-972.3119825708061,-690.0]]
{'amp': -674.653530482481, 
'omega': 0.02495355160582993, 
'phase': 0.0084810129264762, 
'offset': -479.83638765964594}

# 5.jpg -al 0.7 -k 10
# 890 500
data103 = [[-80.0,133.41414413450505,-807.3356514735559],
[-70.0,215.96299075402078,-655.4033225558743],
[-60.0,243.85825052871357,-483.2545072751867],
[-50.0,217.4930126532035,-305.5072916072585],
[-40.0,138.4455824003522,-138.92639942714055],
[-30.0,3.6772228660395854,-17.335182096099174],
[-20.0,-164.94382198884927,44.4546742306084],
[-10.0,-341.67241008868587,54.19254854162024],
[0.0,-490.0,4.152941176470589],
[10.0,-682.1805597824116,58.69280175104217],
[20.0,-862.4780203864732,51.47541157085654],
[30.0,-1026.144123759488,-25.05983536022069],
[40.0,-1172.7890532422655,-126.53327799513664],
[50.0,-1253.3042172250296,-289.7982094433428],
[60.0,-1280.5150657501883,-465.7006658661646],
[70.0,-1249.9885280518697,-636.6658028696452],
[80.0,-1166.279699766409,-787.8059182117477],
[90.0,-996.0521176470588,-890.0]]
{'amp': -748.6217248676287, 
'omega': 0.026291437906555262, 
'phase': 0.002645807041871677, 
'offset': -511.0553015871678}

# signal-2022-05-30-175346_004-laydown.jpg -al 0.7 -k 30
# 996 1495
data30 = [[-80.0,39.244240044273724,-266.0560552089637],
[-70.0,51.1271392785862,-158.9336337635949],
[-60.0,6.573170921743753,-65.28488095515667],
[-50.0,-54.14021021846588,22.485034095246785],
[-40.0,-140.97330885307224,83.7016817458726],
[-30.0,-242.6178936500688,108.52619403603606],
[-20.0,-340.08060530345483,116.37048619063364],
[-10.0,-436.28412090925195,63.95505047012537],
[0.0,-490.0,4.348249818445897],
[10.0,-582.1779854945818,67.17360692161864],
[20.0,-682.0218970829894,122.47641950813386],
[30.0,-782.2335799245785,117.30802694891955],
[40.0,-886.289323388201,96.05679629100399],
[50.0,-973.772058039016,38.25580779245951],
[60.0,-1033.187672758052,-47.34237265916906],
[70.0,-1076.768409372509,-140.0041561831425],
[80.0,-1063.573734043105,-246.26297495674075],
[90.0,-993.8861099007504,-330.0]]
{'amp': -551.2135484271936, 
'omega': 0.018894589620263285, 
'phase': 0.026938117709656997, 
'offset': -498.8504275468523}

# self.zoom_ratio * self.width * (sin(angle * omega + phase)+offset)

# data = data30
# x  = numpy.array([data[i][0] for i in range(len(data))])
# y1 = numpy.array([data[i][1] for i in range(len(data))])
# y2 = numpy.array([data[i][2] for i in range(len(data))])

x = [750,1106,602,723,890,996]
y1 = [.025056923080378993,.021848145517453177,.023819060658213202,.02495355160582993,.026291437906555262,.018894589620263285]

# y1_ = [2000*np.cos(x[i]/50) for i in range(len(x))]
# res = fit_sin(x, y1)
# print(res)

plt.scatter(x, y1)
# plt.plot(x, res["fitfunc"](x))
# plt.plot(x, y2)
plt.show()
